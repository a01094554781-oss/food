import streamlit as st
import pandas as pd
import plotly.express as px

# -----------------------------
# í˜ì´ì§€ ì„¤ì •
# -----------------------------
st.set_page_config(page_title="ì„œìš¸ ìŒì‹ì  ì§€ë„", layout="wide")

st.title("ğŸœ ì„œìš¸ ìŒì‹ì  ì§€ë„ ì‹œê°í™”")
st.markdown("ì¹´í…Œê³ ë¦¬, í‰ì , ì§€ë„ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•´ ë‹¤ì–‘í•œ ìŒì‹ì ì„ íƒìƒ‰í•´ë³´ì„¸ìš”!")

# -----------------------------
# ìƒ˜í”Œ ë°ì´í„° ìƒì„±
# -----------------------------
data = {
    "ì´ë¦„": ["í•œë‚¨ëˆê¹ŒìŠ¤", "ì„ì§€ë¡œëƒ‰ë©´", "í™ëŒ€ë²„ê±°", "ê°•ë‚¨ìŠ¤ì‹œ", "ì„±ìˆ˜ì¹´í˜", "ë§ì›ë¶„ì‹", "ì¢…ë¡œìš°ë™", "ì ì‹¤í”¼ì", "ê±´ëŒ€ì¹˜í‚¨", "ì´íƒœì›íŒŒìŠ¤íƒ€"],
    "ì¹´í…Œê³ ë¦¬": ["ì–‘ì‹", "í•œì‹", "ì–‘ì‹", "ì¼ì‹", "ì¹´í˜", "ë¶„ì‹", "í•œì‹", "ì–‘ì‹", "ì¹˜í‚¨", "ì–‘ì‹"],
    "ìœ„ë„": [37.538, 37.565, 37.556, 37.501, 37.544, 37.556, 37.572, 37.514, 37.541, 37.534],
    "ê²½ë„": [127.002, 127.004, 126.922, 127.027, 127.056, 126.905, 126.978, 127.099, 127.072, 126.995],
    "í‰ì ": [4.7, 4.2, 3.8, 4.9, 4.5, 4.1, 3.9, 4.6, 4.3, 4.8],
    "ì£¼ì†Œ": [
        "ì„œìš¸ ìš©ì‚°êµ¬ í•œë‚¨ë™", "ì„œìš¸ ì¤‘êµ¬ ì„ì§€ë¡œ", "ì„œìš¸ ë§ˆí¬êµ¬ í™ëŒ€ì…êµ¬", "ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™",
        "ì„œìš¸ ì„±ë™êµ¬ ì„±ìˆ˜ë™", "ì„œìš¸ ë§ˆí¬êµ¬ ë§ì›ë™", "ì„œìš¸ ì¢…ë¡œêµ¬ ì¢…ë¡œ3ê°€", "ì„œìš¸ ì†¡íŒŒêµ¬ ì ì‹¤ë™",
        "ì„œìš¸ ê´‘ì§„êµ¬ í™”ì–‘ë™", "ì„œìš¸ ìš©ì‚°êµ¬ ì´íƒœì›ë™"
    ]
}
df = pd.DataFrame(data)

# -----------------------------
# í•„í„° UI
# -----------------------------
col1, col2, col3 = st.columns(3)

with col1:
    category = st.selectbox("ğŸ± ì¹´í…Œê³ ë¦¬ ì„ íƒ", ["ì „ì²´"] + sorted(df["ì¹´í…Œê³ ë¦¬"].unique().tolist()))

with col2:
    rating = st.slider("â­ ìµœì†Œ í‰ì ", 0.0, 5.0, 4.0, 0.1)

with col3:
    map_style = st.selectbox("ğŸ—ºï¸ ì§€ë„ ìŠ¤íƒ€ì¼", [
        "open-street-map", "carto-positron", "stamen-terrain", "stamen-toner", "carto-darkmatter"
    ])

# -----------------------------
# ë°ì´í„° í•„í„°ë§
# -----------------------------
filtered_df = df.copy()
if category != "ì „ì²´":
    filtered_df = filtered_df[filtered_df["ì¹´í…Œê³ ë¦¬"] == category]
filtered_df = filtered_df[filtered_df["í‰ì "] >= rating]

# -----------------------------
# ì§€ë„ ì‹œê°í™”
# -----------------------------
fig_map = px.scatter_mapbox(
    filtered_df,
    lat="ìœ„ë„",
    lon="ê²½ë„",
    color="í‰ì ",
    size="í‰ì ",
    color_continuous_scale="RdYlGn",
    size_max=15,
    hover_name="ì´ë¦„",
    hover_data=["ì£¼ì†Œ", "ì¹´í…Œê³ ë¦¬", "í‰ì "],
    zoom=11,
    height=600
)

fig_map.update_layout(
    mapbox_style=map_style,
    mapbox_center={"lat": 37.55, "lon": 127.0},  # ì„œìš¸ ì¤‘ì‹¬
    margin={"r":0, "t":0, "l":0, "b":0}
)

st.plotly_chart(fig_map, use_container_width=True)

# -----------------------------
# ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  í‰ì  ë°” ì°¨íŠ¸
# -----------------------------
st.subheader("ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  í‰ì ")
avg_ratings = df.groupby("ì¹´í…Œê³ ë¦¬")["í‰ì "].mean().reset_index()
st.bar_chart(avg_ratings.set_index("ì¹´í…Œê³ ë¦¬"))
